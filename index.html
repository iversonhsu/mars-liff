<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­å®šæ˜Ÿç›¤è³‡æ–™</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 20px; background-color: #f5f5f5; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 20px; }
        label { display: block; margin: 15px 0 5px; color: #666; font-size: 14px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; margin-top: 30px; background-color: #06c755; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        button:active { background-color: #05b34c; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ğŸ”® é–‹å•Ÿæ‚¨çš„é­”æ³•æ—…ç¨‹</h2>
        
        <label>ğŸ“… å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="date" required>
        
        <label>â° å‡ºç”Ÿæ™‚é–“</label>
        <input type="time" id="time" required>
        
        <label>ğŸ“ å‡ºç”ŸåŸå¸‚</label>
        <input type="text" id="city" placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚" value="å°åŒ—å¸‚">

        <label>ğŸ‘¤ æ€§åˆ¥</label>
        <select id="gender" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; background: white;">
            <option value="F">å¥³æ€§</option>
            <option value="M">ç”·æ€§</option>
            <option value="U">ä¸é€éœ²</option>
        </select>

        <button id="btn" onclick="send()">ç¢ºèªé€å‡º</button>
    </div>

    <script>
        // é€™è£¡ç­‰ä¸€ä¸‹è¦å¡«å…¥æ‚¨çš„ LIFF ID
        const LIFF_ID = "2009047186-VUUAVTF4";

        // åˆå§‹åŒ–
        liff.init({ liffId: LIFF_ID }).catch(err => {
            alert("å•Ÿå‹•å¤±æ•—ï¼Œè«‹ç¢ºèªæ˜¯åœ¨ LINE ä¸­é–‹å•Ÿ");
        });

    function send() {
        const d = document.getElementById('date').value;
        const t = document.getElementById('time').value; // 24 å°æ™‚åˆ¶æ ¼å¼ï¼Œå¦‚ "22:55"
        const c = document.getElementById('city').value;
        const g = document.getElementById('gender').value; // å–å¾—æ€§åˆ¥ä»£ç¢¼ F/M/U

        if (!d || !t || !c || !g) {
            alert("è«‹å®Œæ•´å¡«å¯«è³‡æ–™å–”ï¼");
            return;
        }

        // --- æ ¼å¼åŒ–é¡¯ç¤ºè³‡æ–™çµ¦ä½¿ç”¨è€…å†æ¬¡ç¢ºèª ---
        const [hour, minute] = t.split(':');
        const h = parseInt(hour);
        const period = h >= 12 ? "ä¸‹åˆ (PM)" : "ä¸Šåˆ (AM)";
        const displayH = h > 12 ? h - 12 : (h === 0 ? 12 : h);
        
        const genderLabels = { "F": "å¥³æ€§", "M": "ç”·æ€§", "U": "ä¸é€éœ²/ä¸­æ€§" };
        const genderText = genderLabels[g];
    
        // å½ˆå‡ºç¢ºèªè¦–çª—ï¼Œæ˜ç¢ºé¡¯ç¤ºã€Œä¸Šåˆ/ä¸‹åˆã€ï¼ŒåŒ…å«æ€§åˆ¥è³‡è¨Š
        const confirmMsg = `æ‚¨é¸æ“‡çš„æ˜¯ï¼š\næ—¥æœŸï¼š${d}\næ™‚é–“ï¼š${period} ${displayH}:${minute}\nåŸå¸‚ï¼š${c}\næ€§åˆ¥ï¼š${genderText}\n\nç¢ºèªé€å‡ºå—ï¼Ÿ`;
        
        if (!confirm(confirmMsg)) {
            return; // ä½¿ç”¨è€…æŒ‰å–æ¶ˆï¼Œå°±ä¸é€å‡º
        }
        // --------------------------------------

        // ä¿®æ”¹æŒ‡ä»¤æ ¼å¼ç‚ºï¼š/birth [æ—¥æœŸ] [æ™‚é–“] [åŸå¸‚] [æ€§åˆ¥]
        const command = `/birth ${d} ${t} ${c} ${g}`;

        liff.sendMessages([{ type: 'text', text: command }])
            .then(() => liff.closeWindow())
            .catch(err => alert("ç™¼é€å¤±æ•—ï¼Œè«‹ç¢ºèªæ‚¨å·²åŠ å…¥å¥½å‹ä¸¦å…è¨±å‚³è¨Š"));
    }
    </script>
</body>
</html>
